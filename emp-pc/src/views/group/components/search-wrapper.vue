<template>    <div class="search-list">        <div class="condition-list">            <Button type="primary" @click="chooseArea">{{area}}</Button>            <Input v-model="deviceNames"  placeholder="请输入设备名" style="width: 300px"></Input>            <Button type="primary" @click="getData(0)">{{lang.search}}</Button>            <Button :type="self" @click="chooseMy">{{lang.myDevice}}</Button>            <Button :type="share" @click="checkDevice">{{shareAccount}}</Button>            <Button v-if="this.$route.name!='chart'" :type="all" @click="getAllOnlineData(0)">全部设备</Button>        </div>        <Modal v-model="modal" title="区域选择" :mask-closable="false">            <div>                <Tree :data="regionalList" @on-select-change="chooseTree"></Tree>            </div>            <div slot="footer">                 <Button @click="getArea" type="primary" >确定</Button>            </div>        </Modal>        <Modal v-model="modal2" title="分享给我的设备" :mask-closable="false">            <div>                <div>                    <Input  v-model="sharedAccount"  placeholder="请输入设备名" style="width: 300px"></Input>                    <Button type="primary"  @click="searchShareToMedevice">搜索</Button>                </div>                <div style="margin-top: 10px;">                    <Table :columns="accountColumns" :data="accountList" @on-selection-change="selectIt" ></Table>                </div>            </div>            <div slot="footer">                <Button @click="chooseAccount" type="primary" >选择</Button>            </div>        </Modal>    </div></template><script>    export default{      name:'chartList',      props:['theName','pageNow'],      computed: {        lang(){          return this.$store.state.lang.btns        }      },        data(){        return {          timer:null,          all:'default',          deviceNames:'',          self:'primary',          share:'default',          area:'选择区域',          sharedAccount:'',          modal2:false,          modal:false,          accountList:[],          accountColumns: [            {              type: 'selection',              width: 60,              align: 'center',              key_checked:'checked'            },            {              title: '账号',              key: 'sharedAccount'            },            {              title: '设备参数',              key: 'deviceCount'            }          ],          regionalList:[],          choosedAreaTemp:{},          shareAccount:'分享给我的设备',          choosedShareAccount:{            sharedUserId:null          },          choosedArea:{},        }      },      beforeDestroy(){        clearInterval(this.timer);      },      mounted(){        const _this = this;        this.checkRegional();        if(this.$route.name=='chart'){          this.getChartData(0)        }else if(this.$route.name=='online-data'||this.$route.name=='online-data-1'){          if(this.theName=='name1'){            _this.getOnlineData(0);            _this.timer = setInterval(function(){              _this.getOnlineData(0)            },15000)          }else if(this.theName=='name2'){            this.getOnlineData(0);          }        }      },      watch:{        modal2(newVal,oldVal){          if(newVal){            this.searchShareToMedevice()          }else{            if(this.choosedShareAccount.sharedUserId != null){              this.shareAccount = this.choosedShareAccount.sharedAccount+"分享给我的设备"              this.self = 'default';              this.share = 'primary';              this.all = 'default';            }else{              this.shareAccount = "分享给我的设备"              this.self = 'primary';              this.share = 'default';              this.all = 'default';            }          }        },        pageNow(){          if(this.$route.name=='chart'){            this.getChartData(this.pageNow)          }else if(this.$route.name=='online-data'||this.$route.name=='online-data-1'){            if(this.theName=='name1'){              this.getOnlineData(this.pageNow)            }else if(this.theName=='name2'){              this.getOnlineData(this.pageNow)            }          }        }      },      methods:{        getData(page){          this.$emit('initPage',page);          if(this.$route.name=='chart'){            this.getChartData(page)          }else if(this.$route.name=='online-data'||this.$route.name=='online-data-1'){            if(this.theName=='name1'){              this.getOnlineData(page)            }else if(this.theName=='name2'){              this.getOnlineData(page)            }          }        },        /*获取所有实时数据*/        getAllOnlineData(page){          this.all = 'primary';          this.self = 'default';          this.share = 'default';          this.$emit('initPage',page);          let userId = this.$cookie.get('userId');          let accessToken = this.$cookie.get('accessToken');          let permissions = this.$cookie.get('permissions');          let data = {            rows:20,            page:page,            regionalId:this.choosedArea.regionalId,            deviceName:this.deviceNames,            sharedUserId:0,            userId:userId,            loginType:2,            accessToken:accessToken,            permissions:permissions          };          this.$http({            method:'post',            url:this.$util.ajaxUrl+"/public/realTimeData",            data          },(res)=>{            let result = res.data;            if(result.code==0){              this.$emit("chartInfo",result.data)            }else{              this.$Message.error(res.data.msg)            }          },(erro)=>{            console.log(erro);          })        },          /*获取实时数据*/        getOnlineData(page){          let userId = this.$cookie.get('userId');          let accessToken = this.$cookie.get('accessToken');          let permissions = this.$cookie.get('permissions');          let data = {            rows:20,            page:page,            regionalId:this.choosedArea.regionalId,            deviceName:this.deviceNames,            sharedUserId:this.choosedShareAccount.sharedUserId,            userId:userId,            loginType:2,            accessToken:accessToken,            permissions:permissions          };          this.$http({            method:'post',            url:this.$util.ajaxUrl+"/public/realTimeData",            data          },(res)=>{            let result = res.data;            if(result.code==0){              this.$emit("chartInfo",result.data)            }else{              this.$Message.error(res.data.msg)            }          },(erro)=>{            console.log(erro);          })        },        /*图线曲线获取数据*/        getChartData(page){          let userId = this.$cookie.get('userId');          let accessToken = this.$cookie.get('accessToken');          let permissions = this.$cookie.get('permissions');          let data = {            rows:6,            page:page,            regionalId:this.choosedArea.regionalId,            deviceName:this.deviceNames,            sharedUserId:this.choosedShareAccount.sharedUserId,            userId:userId,            loginType:2,            accessToken:accessToken,            permissions:permissions          };          this.$http({            method:'post',            url:this.$util.ajaxUrl+"/public/realTimeCurveData",            data          },(res)=>{            let result = res.data;            if(result.code==0){              this.$emit("chartInfo",result.data)            }else{              this.$Message.error(res.data.msg)            }          },(erro)=>{            console.log(erro);          })        },        /*选择账户*/        chooseAccount(){          if(this.choosedShareAccount.sharedUserId!=null){            this.choosedArea = {};            this.modal2 = false;            this.shareAccount = this.choosedShareAccount.sharedAccount+"分享给我的设备"            this.share = 'primary';            this.self = 'default';            this.all = 'default';          }else{            this.shareAccount = "分享给我的设备"            this.modal2 = false;            this.self = 'primary';            this.share = 'default';            this.all = 'default';          };          this.area = '选择区域';          this.getData(0)          this.checkRegional()        },        /*搜索分享给我的设备*/        searchShareToMedevice(){          let _this = this;          let userId = this.$cookie.get('userId');          let accessToken = this.$cookie.get('accessToken');          let permissions = this.$cookie.get('permissions');          let data = {            rows:10,            page:0,            sharedAccount:this.sharedAccount,            userId:userId,            loginType:2,            accessToken:accessToken,            permissions:permissions          };          this.$http({            method:'post',            url:this.$util.ajaxUrl+"/shared/selectSharedForMe",            data          },(res)=>{            let result = res.data;            if(result.code==0){              this.accountList = result.data.dataList;              this.accountList.forEach(function(val,index){                if(val.sharedUserId==_this.choosedShareAccount.sharedUserId){                  val._checked = true                }else{                  val._checked = false                }              })            }else{              this.$Message.error(res.data.msg)            }          },(erro)=>{            console.log(erro);          })        },        selectIt(it){          if(it.length!=0){            this.choosedShareAccount = it[0]          }else{            this.choosedShareAccount = {              sharedUserId:null            };            this.shareAccount = "分享给我的设备"          }        },        chooseMy(){          this.self = 'primary';          this.share = 'default';          this.all = 'default';          this.choosedShareAccount = {            sharedUserId:null          };          this.choosedArea = {};          this.shareAccount = "分享给我的设备";          this.area = '选择区域';          this.getData(0);          this.checkRegional()        },        chooseTree(it){          if(it.length>0){            this.choosedAreaTemp = it[0];          }        },        getArea(){          if(Object.keys(this.choosedAreaTemp).length!=0){            this.choosedArea = this.choosedAreaTemp;            this.area = this.choosedArea.title            this.$emit("getAreaGo",this.choosedAreaTemp);          }else{            this.choosedArea={};            this.area = '选择区域'          }          this.modal = false;        },        checkRegional(){          let userId = this.$cookie.get('userId');          let accessToken = this.$cookie.get('accessToken');          let permissions = this.$cookie.get('permissions');          let data ={            type:0 ,            userId:userId,            sharedUserId:this.choosedShareAccount.sharedUserId,            accessToken:accessToken,            permissions:permissions*1 ,            loginType:2          };          this.$http({            method:'post',            url:this.$util.ajaxUrl+"/regional/getRegional",            data          },(res)=>{            let result = res.data.data;            let list = {};            let resultHandle = [];            result.forEach(function(val,index){              list = {                title:val.regionalName,                regionalId:val.regionalId,                upRegionalId:val.upRegionalId,                children:[]              };              val.childRegional.forEach(function(value,i){                list.children.push({                  title:value.regionalName,                  regionalId:value.regionalId,                  upRegionalId:value.upRegionalId                })              })              resultHandle.push(list)            })            this.regionalList = resultHandle          },(erro)=>{            console.log(erro)          })        },        chooseArea(){          this.area = '选择区域';          this.modal = true;        },        checkDevice(){         this.modal2 = true        }      }    }</script>