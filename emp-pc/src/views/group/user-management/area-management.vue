<style lang="less" scoped>    @import "area-management";</style><template>    <div class="area-management">        <div class="contrl-wrapper">            <div class="contrl-left">                <div class="contrl-left-title">区域</div>                <div class="the-tree">                    <Tree :data="regionalList" @on-select-change="chooseTree"></Tree>                </div>                <div class="btns-wrapper">                    <span class="btn" v-show="showAdd" @click="addOrEidt"><Icon type="plus-round"></Icon></span>                    <span class="btn" v-show="regionalChoosed.regionalId" @click="del"><Icon type="minus-round"></Icon></span>                </div>            </div>            <div class="contrl-right" v-show="showDetail">                <div class="contrl-right-title">详情</div>                <div class="the-detail">                    <Form ref="regionalValidate" :model="regionalValidate" :rules="ruleValidate" :label-width="80" class="transform-content">                        <FormItem label="区域名称" prop="regionalName">                            <Input v-model="regionalValidate.regionalName" placeholder="请输入区域名称"></Input>                        </FormItem>                        <FormItem label="区域描述" prop="regionalDesc">                            <Input v-model="regionalValidate.regionalDesc" type="textarea" placeholder="请输入对区域的描述"></Input>                        </FormItem>                        <FormItem label="设备分配" prop="value" v-show="deviceExpend" class="list-item">                            <Transfer                                    :data="deviceList"                                    :target-keys="targetKeys"                                    filterable                                    :titles="['未分配设备','当前区域设备']"                                    :filter-method="filterMethod"                                    @on-change="handleChange"></Transfer>                        </FormItem>                    </Form>                    <div class="save-all">                        <Button type="primary"  size="small" @click="save('regionalValidate')">保存</Button>                    </div>                </div>            </div>        </div>    </div></template><script>  import {mapState, mapMutations} from 'vuex';  export default {    name: 'areaManagement',    data(){      return {        showAdd:true,        deviceList: [],        targetKeys: [],        regionalValidate:{          regionalName:'',          regionalDesc:''        },        ruleValidate:{          regionalName: [            { required: true, message: '区域名称不能为空', trigger: 'blur' }          ],          regionalDesc: [            { required: true, message: '区域描述不能为空', trigger: 'blur' }          ]        },        regionalList: [],        regionalChoosed:{},        regionalChoosedTemp:{          upRegionalId:0,          regionalId:0        },        regionalIdNow:0,//其他代表未选中一级区域，0代表选中一级区域        showDetail:false,        deviceExpend:false      }    },    mounted(){      this.checkRegional();    },    methods:{      del(){        let userId = this.$cookie.get('userId');        let accessToken = this.$cookie.get('accessToken');        let permissions = this.$cookie.get('permissions');        let data = {          regionalId:this.regionalChoosed.regionalId,          loginType:2,          userId:userId,          accessToken:accessToken,          permissions:permissions        };        this.$http({          method:'post',          url:this.$util.ajaxUrl+"/regional/deleteRegional",          data        },(res)=>{          this.checkRegional();          this.showDetail = false;          this.$Message.success('删除成功!');        },(erro)=>{          console.log(erro);        })      },      save(name) {        this.$refs[name].validate((valid) => {            if (valid) {              let userId = this.$cookie.get('userId');              let accessToken = this.$cookie.get('accessToken');              let permissions = this.$cookie.get('permissions');              let data = {                upRegionalId: this.regionalChoosed.upRegionalId,                regionalName: this.regionalValidate.regionalName,                regionalDesc: this.regionalValidate.regionalDesc,                regionalId: this.regionalChoosed.regionalId,                devices: this.targetKeys,                userId: userId,                loginType: 2,                accessToken: accessToken,                permissions: permissions              };              this.$http({                method: 'post',                url: this.$util.ajaxUrl + "/regional/saveRegional",                data              }, (res) => {                let result = res.data;                this.$Message.success('保存成功!');                this.showDetail = false;                this.checkDeviceList();                this.checkRegional();              }, (erro) => {                console.log(erro);              })            }          })      },      //查询区域设备信息      checkDeviceList(){        const _this = this;        this.targetKeys = [];        this.deviceList = [];        /*只有子区域的时候才会有设备列表，即upRegionalId不为0的时候*/        let userId = this.$cookie.get('userId');        let accessToken = this.$cookie.get('accessToken');        let permissions = this.$cookie.get('permissions');        let data = {          regionalId:this.regionalChoosed.regionalId,          upRegionalId:this.regionalChoosed.upRegionalId,          loginType:2,          userId:userId,          accessToken:accessToken,          permissions:permissions        };        this.$http({          method:'post',          url:this.$util.ajaxUrl+"/regional/selectRegional",          data        },(res)=>{           let result = res.data.data;           this.regionalValidate  = {              regionalName:result.regionalName,              regionalDesc:result.regionalDesc           };           /*已选中区域列表处理*/            if(result.regionaldevices&&result.regionaldevices.length !=0){              result.regionaldevices.forEach(function(val,index){                _this.targetKeys.push(val.sn)              })            };          /*二级区域存在区域列表*/          if(result.devices&&result.devices.length!=0){              result.devices.forEach(function(val,index){                _this.deviceList.push({                  key:val.sn,                  label:val.deviceName,                  disabled:false                })              })            };        },(erro)=>{          console.log(erro)        })      },      /*增加设备*/      addOrEidt(){        if(this.regionalChoosed.regionalId&&this.regionalChoosed.regionalId != 0 ){          //父目录为0的时候，为一级目录            this.deviceExpend = true;            this.regionalChoosed = {              regionalId:0,              upRegionalId:this.regionalChoosed.regionalId            };           this.checkDeviceList();        }else{          this.deviceExpend = false;          this.regionalChoosed = this.regionalChoosedTemp        }        /*显示右边侧边详情*/        this.showDetail = true;        this.regionalValidate = {           regionalName:'',           regionalDesc:''        };      },      chooseTree(it){        if(it.length!=0){          this.showDetail = true;          this.regionalChoosed = {            regionalId:it[0].regionalId,            upRegionalId:it[0].upRegionalId          };          this.checkDeviceList()        }else{          this.showDetail = false;          this.regionalChoosed ={}        };        if(this.regionalChoosed.upRegionalId !=0 ){          this.deviceExpend = true;          this.showAdd = false        }else{          this.deviceExpend = false;          this.showAdd = true        };      },      checkRegional(){        let userId = this.$cookie.get('userId');        let accessToken = this.$cookie.get('accessToken');        let permissions = this.$cookie.get('permissions');        let data ={          type:0 ,          userId:userId,          accessToken:accessToken,          permissions:permissions*1 ,          loginType:2      };        this.$http({          method:'post',          url:this.$util.ajaxUrl+"/regional/getRegional",          data        },(res)=>{          console.log(res.data.data);          let result = res.data.data;          let list = {};          let resultHandle = [];          result.forEach(function(val,index){                list = {                  title:val.regionalName,                  regionalId:val.regionalId,                  upRegionalId:val.upRegionalId,                  children:[]                };                val.childRegional.forEach(function(value,i){                    list.children.push({                      title:value.regionalName,                      regionalId:value.regionalId,                      upRegionalId:value.upRegionalId                    })                })             resultHandle.push(list)          })          this.regionalList = resultHandle        },(erro)=>{          console.log(erro)        })      },      handleChange (newTargetKeys) {        this.targetKeys = newTargetKeys;      },      filterMethod (data, query) {        return data.label.indexOf(query) > -1;      }    }  };</script>