<style lang="less" scoped>    #qrCodeBox{        text-align:center;        width: 250px;        height: 250px;        margin: 0 auto;    }    .info-list-detail{        li{            min-height: 40px;            height: auto;            display: flex;            span:first-child{                width: 100px;            }            span:last-child{                flex: 1;            }            .charge-btn{                text-align: center;                padding: 30px 0;                .ivu-btn{                    width: 200px;                }            }            .charge-list{                .ivu-tag{                    width:100px;                    text-align: center;                }            }        }    }</style><template>    <div>        <Tabs value="name1">            <TabPane label="短信充值" name="name1">                <Card style="width:600px;margin:0 auto;">                    <p slot="title">                        <Icon type="ios-film-outline"></Icon>                        短信充值                    </p>                    <ul class="info-list-detail">                        <li>                            <span>账号：</span>                            <span>{{basicInfo.account}}</span>                        </li>                        <li>                            <span>剩余短信条数：</span>                            <span>{{basicInfo.remainMsgNum}}条</span>                        </li>                        <li>                            <span>充值价格：</span>                            <span class="charge-list">                                 <Tag   class="tag-one" :key="index" @click.native="chooseIt(index,item)" :color="list[index]?'blue':'default'" v-for="(item,index) in basicInfo.smpList">{{item.price}}元\{{item.msgNum}}条</Tag>                            </span>                        </li>                        <li>                            <span>充值途径：</span>                            <span>微信充值</span>                        </li>                        <li>                            <span class="charge-btn">                                <Button type="primary" size="small" @click="charge">充值</Button>                            </span>                        </li>                    </ul>                </Card>            </TabPane>            <TabPane label="数据保留时间充值" name="name2">                <Card style="width:600px;margin:0 auto;">                    <ul class="info-list-detail">                        <li>                            <span>账号：</span>                            <span>{{basicInfo.account}}</span>                        </li>                        <li>                            <span>数据延长时间：</span>                            <span>                                <Select v-model="chooseMonth" style="width:200px" size="small" @on-change="changeTime">                                    <Option v-for="item in monthList" :value="item.id" :key="item.id">{{ item.describe }}</Option>                                </Select>                            </span>                        </li>                        <li>                            <span>开通时长：</span>                            <span>                                <Select v-model="timeTo" style="width:200px"  size="small" @on-change="changeTime">                                    <Option v-for="item in monthList" :value="item.id" :key="item.id">{{ item.describe }}</Option>                                </Select>                            </span>                        </li>                        <li>                            <span>价格：</span>                            <span>{{priceIt}}元</span>                        </li>                        <li>                            <span>充值途径：</span>                            <span>微信充值</span>                        </li>                        <li>                            <span class="charge-btn">                                <Button type="primary" size="small" @click="chargeTime">充值</Button>                            </span>                        </li>                    </ul>                    <div style="background:#eee;padding: 20px;width: 500px;display: inline-block;margin:10px auto;">                        <Card :bordered="false">                            <p slot="title">优惠信息</p>                            <p>{{discount}} </p>                        </Card>                    </div>                </Card>            </TabPane>        </Tabs>        <Modal v-model="qrCodeModal" width="360" :mask-closable="false">            <p slot="header" style="color:#f60;text-align:center">                <Icon type="information-circled"></Icon>                <span>扫描二维码</span>            </p>            <div id="qrCodeBox"></div>            <div slot="footer"></div>        </Modal>    </div></template><script>  import QRcode from 'qrcodejs2'  import Cookies from 'js-cookie';  let _from = '';  export default {    name: 'add_new_service',    data(){      return{        userId:'',        accessToken:'',        permissions:'',        qrCodeModal:false,        monthList:[],        chooseMonth:'',        timeTo:'',        priceIt:0,        cityList: [          {            value: 'New York',            label: 'New York'          },          {            value: 'London',            label: 'London'          }          ],        basicInfo:{},        list:[],        smsId:'',        discount:''      }    },    beforeRouteEnter (to, from, next) {      _from = from.name      next()    },    mounted(){      this.accessToken = this.$cookie.get('accessToken');      this.permissions = this.$cookie.get('permissions');      if(_from == 'customer-data-index'){        this.userId = this.$route.query.userId;      }else{        this.userId = this.$cookie.get('userId');      }      this.getList();      this.getChargeMonth();      this.getDiscount()    },    watch:{      qrCodeModal(newVal,oldVal){        if(!newVal){          this.getList()          document.querySelector("#qrCodeBox").html = '';          window.location.reload()        }      }    },    methods:{      getDiscount(){        let data = {          loginType:2,          userId:this.userId,          accessToken:this.accessToken,          permissions:this.permissions        };        this.$http({          method:'post',          url:this.$util.ajaxUrl+"/payment/getDiscounts",          data        },(res)=>{          let result = res.data;          if(result.code==0){            this.discount = result.msg          }else{            this.$Message.error(res.data.msg)          }        },(erro)=>{          console.log(erro);        })      },      changeTime(){        let data = {          historyDateId:this.chooseMonth,          openDateId:this.timeTo,          loginType:2,          userId:this.userId,          accessToken:this.accessToken,          permissions:this.permissions        };        this.$http({          method:'post',          url:this.$util.ajaxUrl+"/payment/getDataPrice",          data        },(res)=>{          let result = res.data;          if(result.code==0){                this.priceIt = result.data.price          }else{            this.$Message.error(res.data.msg)          }        },(erro)=>{          console.log(erro);        })      },      /*获取充值月份*/      getChargeMonth(){        let data = {          loginType:2,          userId:this.userId,          accessToken:this.accessToken,          permissions:this.permissions        };        this.$http({          method:'post',          url:this.$util.ajaxUrl+"/payment/getDataCode",          data        },(res)=>{          let result = res.data;          if(result.code==0){            this.monthList = result.data            if(result.data.length>0){              this.chooseMonth = result.data[0].id              this.timeTo =  result.data[0].id            }          }else{            this.$Message.error(res.data.msg)          }        },(erro)=>{          console.log(erro);        })      },      chooseIt(it,item){        var temp  = []        this.list.forEach(function (val,index) {          temp.push(false)        });        this.list = temp;        this.list.splice(it,1,true);        this.smsId = item.id      },      setQrcode(content){        var qrCodeBox = document.getElementById('qrCodeBox');        qrCodeBox.innerHTML = '';        var qrcode = new QRcode(document.getElementById('qrCodeBox'),content );      },      chargeTime(){        let data = {          payType:2,          historyDateId:this.chooseMonth,          openDateId:this.timeTo,          loginType:2,          userId:this.userId,          accessToken:this.accessToken,          permissions:this.permissions        };        this.$http({          method:'post',          url:this.$util.ajaxUrl+"/payment/submitSmsPc",          data        },(res)=>{          console.log(res);          let result = res.data;          if(result.code==0){            this.qrCodeModal = true;            this.setQrcode(result.data.codeUrl)          }else{            this.$Message.error(res.data.msg)          }        },(erro)=>{          console.log(erro);        })      },      /*充值*/      charge(){        if(this.smsId==''){          this.$Message.error("请先选择充值金额 ")          return        };        let data = {          payType:1,          smsId:this.smsId,          loginType:2,          userId:this.userId,          accessToken:this.accessToken,          permissions:this.permissions        };        this.$http({          method:'post',          url:this.$util.ajaxUrl+"/payment/submitSmsPc",          data        },(res)=>{          let result = res.data;          if(result.code==0){            this.qrCodeModal = true;            this.setQrcode(result.data.codeUrl)          }else{            this.$Message.error(res.data.msg)          }        },(erro)=>{          console.log(erro);        })      },      /*获取基础信息*/      getList(){        const _this = this;        let userId = this.$cookie.get('userId');        let accessToken = this.$cookie.get('accessToken');        let permissions = this.$cookie.get('permissions');        let data = {          loginType:2,          userId:this.userId,          accessToken:this.accessToken,          permissions:this.permissions        };        this.$http({          method:'post',          url:this.$util.ajaxUrl+"/payment/getSmsCode",          data        },(res)=>{          let result = res.data;          if(result.code==0){            this.basicInfo = result.data;            Cookies.set('msgNum', result.data.remainMsgNum);            this.basicInfo.smpList.forEach(function (val,index) {                _this.list.push(false)            })          }else{            this.$Message.erro(res.data.msg)          }        },(erro)=>{          console.log(erro);        })      }    }  };</script>