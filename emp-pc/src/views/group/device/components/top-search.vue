<style lang="less">    .regional-list{        height: 300px;        overflow:auto;    }</style><template>    <div class="top-search" >        <Input v-model="chooseAreaName" :placeholder="lang.chooseArea" style="width: 100px"  @on-focus="onChooseArea"></Input>        <Input v-model="deviceName" :placeholder="lang.inDeviceName" style="width: 300px"  ></Input>        <Button type="primary" @click="initDeviceList(0)">{{lang.search}}</Button>        <Button @click="modalShare=true">{{lang.addService}}</Button>        <Modal v-model="modalList" :title="lang.chooseArea" :mask-closable="false">            <div class="regional-list">                <Tree :data="regionalList" @on-select-change="chooseTheArea"></Tree>            </div>            <div slot="footer">                <Button @click="confirmChoose" type="primary" >{{lang.confirm}}</Button>            </div>        </Modal>        <!--设备添加-->        <Modal v-model="modalShare" :title="lang.addService" >            <div>                <Form ref="addDevice" :model="addDevice" :rules="addDeviceValidate" :label-width="150">                    <FormItem :label="lang.deviceSNnum" prop="snName">                        <Input v-model="addDevice.snName" :placeholder="lang.inSNnum"></Input>                    </FormItem>                    <FormItem :label="lang.deviceName" prop="deviceName">                        <Input v-model="addDevice.deviceName" :placeholder="lang.inDeviceName"></Input>                    </FormItem>                    <FormItem :label="lang.deviceInArea" prop="timeZone">                        <Select v-model="addDevice.timeZone">                            <Option :value="item.timeCode" :key="item.timeCode" v-for="item in timeList">{{item.timeCodeName}}</Option>                        </Select>                    </FormItem>                    <FormItem>                        <Button type="primary" size="large" @click="toAddDevice('addDevice')">{{lang.add}}</Button>                    </FormItem>                </Form>            </div>            <div slot="footer">            </div>        </Modal>    </div></template><script>    export default{      name:'topSearch',      computed: {        lang(){          return this.$store.state.lang.btns        }      },      props:["pageNow"],      watch:{        pageNow(newVal,oldVal){          this.initDeviceList(newVal);        },        modalShare(newVal,oldVal){          if(newVal){            this.getTimeList()          }        },      },      mounted(){        this.initDeviceList(0);        this.checkRegional()      },      data(){        return {          chooseAreaName:'',          deviceName:'',          modalList:false,          modalShare:false,          addDevice:{            snName:'',            deviceName:'',            timeZone:'',          },          timeList:[],          addDeviceValidate:{            snName: [              { required: true, message: '设备SN号不能为空', trigger: 'blur' }            ],            deviceName: [              { required: true, message: '设备名称不能为空', trigger: 'blur' }            ],            timeZone: [              { required: true, message: '设备所在时区不能为空', trigger: 'change' }            ]          },          regionalList:[],          choosedArea:{},          choosedAreaTemp:{}        }      },      methods:{        onChooseArea(){          this.modalList = true;          this.chooseAreaName = '';          this.choosedArea = {};          this.choosedAreaTemp = {}        },        /*时区*/        getTimeList(){          let userId = this.$cookie.get('userId');          let accessToken = this.$cookie.get('accessToken');          let permissions = this.$cookie.get('permissions');          let data = {            userId:userId,            loginType:2,            accessToken:accessToken,            permissions:permissions          };          this.$http({            method:'post',            url:this.$util.ajaxUrl+"/public/getTimeCode",            data          },(res)=>{            let result = res.data;           this.timeList = result.data;          },(erro)=>{            console.log(erro);          })        },        /*添加设备*/        toAddDevice(name){          this.$refs[name].validate((valid) => {            if(valid){              let userId = this.$cookie.get('userId');              let accessToken = this.$cookie.get('accessToken');              let permissions = this.$cookie.get('permissions');              let data = {                sn:this.addDevice.snName,                deviceName :this.addDevice.deviceName,                timeCode:this.addDevice.timeZone,                userId:userId,                loginType:2,                accessToken:accessToken,                permissions:permissions              };              this.$http({                method:'post',                url:this.$util.ajaxUrl+"/warning/addDevice",                data              },(res)=>{                let result = res.data;                this.initDeviceList(0);                this.$Message.warning(result.msg);                this.modalShare = false;              },(erro)=>{                console.log(erro);              })            }else{              this.$Message.warning("请先完善信息");            }          })        },        /*查询设备列表*/        initDeviceList(page){          this.$emit("initPage",page);          let userId = this.$cookie.get('userId');          let accessToken = this.$cookie.get('accessToken');          let permissions = this.$cookie.get('permissions');          let data = {            rows:15,            page:page,            regionalId:this.choosedArea.regionalId?this.choosedArea.regionalId:null,            deviceName:this.deviceName?this.deviceName:null,            userId:userId,            loginType:2,            accessToken:accessToken,            permissions:permissions          };          this.$http({            method:'post',            url:this.$util.ajaxUrl+"/warning/selectDevices",            data          },(res)=>{            let result = res.data;            if(result.code==0){              this.$emit("choosedDeviceList",result.data);            }          },(erro)=>{            console.log(erro);          })        },        confirmChoose(){          this.choosedArea = this.choosedAreaTemp;          if(this.choosedArea){            this.chooseAreaName = this.choosedArea.title?this.choosedArea.title:this.lang.chooseArea          }else{            this.chooseAreaName = ''          };          this.modalList = false;        },        chooseTheArea(it){          if(it.length>0){            this.choosedAreaTemp = it[0];          }else{            this.choosedAreaTemp = {};          }        },        checkRegional(){          let userId = this.$cookie.get('userId');          let accessToken = this.$cookie.get('accessToken');          let permissions = this.$cookie.get('permissions');          let data ={            type:0 ,            userId:userId,            accessToken:accessToken,            permissions:permissions*1 ,            loginType:2          };          this.$http({            method:'post',            url:this.$util.ajaxUrl+"/regional/getRegional",            data          },(res)=>{            let result = res.data.data;            let list = {};            let resultHandle = [];            result.forEach(function(val,index){              list = {                title:val.regionalName,                regionalId:val.regionalId,                upRegionalId:val.upRegionalId,                children:[]              };              val.childRegional.forEach(function(value,i){                list.children.push({                  title:value.regionalName,                  regionalId:value.regionalId,                  upRegionalId:value.upRegionalId                })              })              resultHandle.push(list)            })            this.regionalList = resultHandle          },(erro)=>{            console.log(erro)          })        }      }    }</script>